å½“ç„¶å¯ä»¥ï¼ä»¥ä¸‹æ˜¯å¯¹ **Project Reactor** çš„è¯¦ç»†ä»‹ç»ï¼Œæ¶µç›–å®ƒçš„æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„è®¾è®¡ã€å¸¸ç”¨ APIã€ä¸ Spring çš„å…³ç³»ã€ä½¿ç”¨åœºæ™¯ç­‰ï¼Œé€‚åˆä½ ä»å…¥é—¨åˆ°æ·±å…¥äº†è§£ã€‚

---

# ğŸŒŠ ä»€ä¹ˆæ˜¯ Project Reactorï¼Ÿ

**Project Reactor** æ˜¯ç”± **Pivotalï¼ˆç°å± VMwareï¼‰** ä¸»å¯¼å¼€å‘çš„ä¸€ä¸ª **å“åº”å¼ç¼–ç¨‹æ¡†æ¶**ï¼Œå®ƒæ˜¯ Java å¹³å°ä¸Šçš„ä¸€ä¸ª **å“åº”å¼æµï¼ˆReactive Streamsï¼‰** å®ç°ã€‚

>  å®ƒæ˜¯ Spring WebFlux èƒŒåçš„æ ¸å¿ƒåº“ï¼Œæ˜¯å“åº”å¼ç³»ç»Ÿçš„åŸºçŸ³ã€‚

---

## ğŸ“¦ é¡¹ç›®å®˜ç½‘ä¸æºç 

* å®˜ç½‘ï¼š[https://projectreactor.io/](https://projectreactor.io/)
* GitHubï¼š[https://github.com/reactor/reactor-core](https://github.com/reactor/reactor-core)
* Maven ä¸­å¿ƒåº“åï¼š`io.projectreactor:reactor-core`

---

## ğŸ§  æ ¸å¿ƒç†å¿µ

Reactor åŸºäº **Reactive Streams è§„èŒƒ**ï¼Œå¼•å…¥äº†èƒŒå‹ï¼ˆBackpressureï¼‰æ”¯æŒï¼Œè§£å†³ä¼ ç»Ÿå¼‚æ­¥ç¼–ç¨‹ä¸­çš„ä»¥ä¸‹é—®é¢˜ï¼š

* å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰
* çº¿ç¨‹èµ„æºæµªè´¹ï¼ˆåŒæ­¥é˜»å¡ï¼‰
* æ•°æ®æµæ§åˆ¶å›°éš¾ï¼ˆæ— æµé‡æ§åˆ¶ï¼‰

---

## ğŸ”© æ ¸å¿ƒç±»å‹

### 1. `Flux<T>`

* è¡¨ç¤º **0 åˆ° N ä¸ªå…ƒç´ ** çš„å¼‚æ­¥æ•°æ®æµ
* æ”¯æŒæµå¼å¤„ç†ã€è½¬æ¢ã€è¿‡æ»¤ç­‰æ“ä½œ
* ç±»ä¼¼ `Stream<T>`ï¼Œä½†æ˜¯ **å¼‚æ­¥ã€éé˜»å¡ã€æ”¯æŒèƒŒå‹çš„**

```java
Flux.just(1, 2, 3)
    .map(i -> i * 2)
    .subscribe(System.out::println);
```

---

### 2. `Mono<T>`

* è¡¨ç¤º **0 æˆ– 1 ä¸ªå…ƒç´ ** çš„å¼‚æ­¥æ•°æ®æµ
* é€‚åˆç”¨äºä¸€æ¬¡å“åº”ï¼ˆå¦‚ HTTP è¯·æ±‚è¿”å›ã€æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼‰

```java
Mono.just("Hello")
    .map(String::toUpperCase)
    .subscribe(System.out::println);
```

---

### 3. `Scheduler`

* çº¿ç¨‹è°ƒåº¦å™¨ï¼Œç”¨äºæ§åˆ¶åœ¨å“ªä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼š

    * `Schedulers.immediate()`
    * `Schedulers.single()`
    * `Schedulers.elastic()` / `boundedElastic()`
    * `Schedulers.parallel()`

---

## ğŸ•¹ å¸¸ç”¨æ“ä½œç¬¦

| æ“ä½œç¬¦                      | æè¿°                |
| ------------------------ | ----------------- |
| `map` / `flatMap`        | è½¬æ¢æ•°æ®ã€é“¾å¼æ“ä½œ         |
| `filter`                 | è¿‡æ»¤å…ƒç´               |
| `subscribeOn`            | æŒ‡å®šæµçš„ **è®¢é˜…çº¿ç¨‹**     |
| `publishOn`              | æŒ‡å®šæµçš„ **åç»­æ“ä½œæ‰§è¡Œçº¿ç¨‹** |
| `zip`, `merge`, `concat` | åˆå¹¶å¤šä¸ªæµ             |
| `retry`, `onErrorResume` | é”™è¯¯æ¢å¤å¤„ç†            |

---

## ğŸ§± æ¶æ„æ¨¡å‹

```
Publisher (Flux/Mono) â†’ Subscriber â†’ Subscription (èƒŒå‹åè®®)
```

ç¬¦åˆ [Reactive Streams æ ‡å‡†](https://www.reactive-streams.org/)ï¼š

* æ”¯æŒ **å¼‚æ­¥**ã€**éé˜»å¡**ã€**èƒŒå‹æ§åˆ¶**
* æä¾›æµå¼æ“ä½œç¬¦ï¼Œé“¾å¼ç»„åˆè¡¨è¾¾é€»è¾‘

---

## ğŸ’¡ ä¸ Spring çš„å…³ç³»

| æ¡†æ¶                   | ä½¿ç”¨ Reactor çš„æ–¹å¼                    |
| -------------------- | --------------------------------- |
| Spring WebFlux       | åŸºäº Reactor æ„å»ºå“åº”å¼ Web æ¡†æ¶           |
| Spring Cloud Gateway | ä½¿ç”¨ Reactor å®ç°å¼‚æ­¥è½¬å‘                 |
| Spring Data R2DBC    | å“åº”å¼æ•°æ®åº“è®¿é—®                          |
| Spring Security 5+   | æ”¯æŒ Reactor çš„ `Mono` / `Flux` å®‰å…¨è®¤è¯ |

Spring WebFlux ç¤ºä¾‹ï¼š

```java
@GetMapping("/hello")
public Mono<String> hello() {
    return Mono.just("Hello WebFlux!");
}
```

---

## ğŸ“š å®é™…åº”ç”¨åœºæ™¯

* é«˜å¹¶å‘ã€é«˜ååé‡ Web æœåŠ¡ï¼ˆå¦‚ Spring Cloud Gatewayï¼‰
* å“åº”å¼ Web APIï¼ˆSpring WebFluxï¼‰
* å“åº”å¼æ•°æ®åº“è®¿é—®ï¼ˆå¦‚ R2DBCï¼‰
* å¾®æœåŠ¡é€šä¿¡ï¼ˆå¼‚æ­¥ã€éé˜»å¡ï¼‰
* I/O å¯†é›†å‹æœåŠ¡ï¼ˆå¦‚æ–‡ä»¶ä¸Šä¼ ã€RPCï¼‰

---

## ğŸ§ª å¸¸è§è°ƒè¯•æŠ€å·§

* ä½¿ç”¨ `.log()` æ‰“å°æ‰§è¡Œæµç¨‹
* ä½¿ç”¨ `StepVerifier` åšå•å…ƒæµ‹è¯•
* ç†è§£ `subscribeOn` å’Œ `publishOn` çš„åŒºåˆ«

---

## ğŸ“¦ ç¤ºä¾‹ï¼šéé˜»å¡ IO æµ

```java
Flux.range(1, 5)
    .publishOn(Schedulers.parallel())
    .map(i -> {
        System.out.println(Thread.currentThread().getName() + ": " + i);
        return i * 2;
    })
    .subscribe();
```

---

## ğŸ› ï¸ é¡¹ç›®ä¼˜ç¼ºç‚¹

###  ä¼˜ç‚¹ï¼š

* æ€§èƒ½ä¼˜å¼‚ï¼Œæ”¯æŒé«˜å¹¶å‘
* æ”¯æŒèƒŒå‹ï¼Œé¿å…èµ„æºæ·¹æ²¡
* ä¸ Spring åŸç”Ÿé›†æˆç´§å¯†
* æ”¯æŒå¼‚æ­¥/äº‹ä»¶é©±åŠ¨ç¼–ç¨‹

### âŒ ç¼ºç‚¹ï¼š

* ä¸Šæ‰‹æœ‰ä¸€å®šå­¦ä¹ æ›²çº¿
* è°ƒè¯•ç›¸å¯¹å›°éš¾ï¼ˆå¼‚æ­¥ï¼‰
* é”™è¯¯å¤„ç†é“¾è¾ƒå¤æ‚

---

## ğŸ“Œ æ€»ç»“ä¸€å¥è¯

> Project Reactor æ˜¯ Java ä¸–ç•Œä¸­æœ€é‡è¦çš„å“åº”å¼ç¼–ç¨‹å·¥å…·ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ä»¥å‡½æ•°å¼ã€æµå¼çš„æ–¹å¼ï¼Œç¼–å†™é«˜æ€§èƒ½ã€å¼‚æ­¥ã€éé˜»å¡çš„ç¨‹åºã€‚

---

å¦‚ä½ å¯¹æŸä¸ªç‚¹ï¼ˆå¦‚ `Flux` è¿ä½œåŸç†ã€è°ƒåº¦å™¨æœºåˆ¶ã€èƒŒå‹å®ç°ã€ä¸çº¿ç¨‹çš„å…³ç³»ç­‰ï¼‰ç‰¹åˆ«æ„Ÿå…´è¶£ï¼Œæˆ‘å¯ä»¥æ·±å…¥è®²ä¸€è®²ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

æ˜¯çš„ï¼Œ**Nacos 2.x å®¢æˆ·ç«¯**ä¸­å¤§é‡ä½¿ç”¨äº† **Reactor** ç›¸å…³çš„æŠ€æœ¯ï¼Œç‰¹åˆ«æ˜¯åœ¨ä»¥ä¸‹ä¸¤ä¸ªåœºæ™¯ä¸­ï¼š

---

##  1. **Nacos å®¢æˆ·ç«¯ä¸­çš„å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ä¸å“åº”å¼æ€æƒ³**

è™½ç„¶ Nacos æœ¬èº«æ²¡æœ‰ç›´æ¥ä¾èµ– `Project Reactor`ï¼ˆæ¯”å¦‚ä¸ä¼šç”¨ `Flux`ã€`Mono` è¿™ç§ APIï¼‰ï¼Œä½†åœ¨ **2.x æ¶æ„è®¾è®¡ä¸­å¼•å…¥çš„æ€æƒ³å’Œæœºåˆ¶ï¼Œä¸ Reactor é«˜åº¦ç±»ä¼¼æˆ–å…¼å®¹**ã€‚

å…·ä½“ä½“ç°ä¸ºï¼š

| é¡¹ç›®                                             | ä½¿ç”¨æƒ…å†µ                        |
| ---------------------------------------------- | --------------------------- |
| gRPC é•¿è¿æ¥æ¨é€                                     | å¼‚æ­¥æ¶ˆæ¯å¤„ç†ã€å“åº”å¼äº‹ä»¶è°ƒåº¦              |
| æœåŠ¡è®¢é˜…ç›‘å¬                                         | å¼‚æ­¥å›è°ƒæœºåˆ¶ã€äº‹ä»¶é©±åŠ¨æ›´æ–°ç¼“å­˜             |
| æœåŠ¡æ³¨å†Œ/ä¸‹çº¿                                        | è°ƒç”¨çº¿ç¨‹ä¸å¤„ç†çº¿ç¨‹åˆ†ç¦»ï¼ˆéé˜»å¡ï¼‰            |
| Nacos Client 2.x ä¸­çš„ `ReactorThreadPoolManager` | æ˜ç¡®å‘½åè¡¨æ˜é‡‡ç”¨ Reactor-style æ¨¡å¼è°ƒåº¦ |

---

### ğŸš© ä¸¾ä¸ªçœŸå®ç±»ï¼š`ReactorThreadPoolManager`

ä½ç½®ï¼š

```java
com.alibaba.nacos.common.utils.ExecutorUtil
com.alibaba.nacos.common.executor.ThreadPoolManager
```

è®¾è®¡æ€æƒ³ï¼š

* å¼‚æ­¥ä»»åŠ¡æ± é‡‡ç”¨â€œReactor æ¨¡å¼â€
* å®ç°ä»»åŠ¡æ„ŸçŸ¥ + å›è°ƒå¼å¤„ç†ï¼ˆå…¸å‹çš„å“åº”å¼è®¾è®¡ï¼‰

---

##  2. åœ¨ **Spring Cloud Alibaba + Nacos Gateway** ä¸­é—´ä½¿ç”¨äº† Project Reactor

è™½ç„¶ Nacos æœ¬èº«ä¸ä¾èµ– Reactorï¼Œä½†å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ï¼š

* **Spring Cloud Gateway**ï¼ˆNetty + Reactorï¼‰
* **Spring Boot WebFlux**
* **Spring Cloud Alibaba Nacos Discovery**

é‚£ä¹ˆæœ€ç»ˆä½ çš„æœåŠ¡å‘ç°ã€è®¢é˜…ã€è½¬å‘ã€è¿‡æ»¤é“¾ä¸­ï¼Œéƒ½ä¼šé€šè¿‡ **Reactor** æ‰§è¡Œï¼Œæµç¨‹å¦‚ä¸‹ï¼š

---

### ğŸ”„ ç½‘å…³æœåŠ¡å‘ç°æµç¨‹ä¸­çš„ Reactor ä¼ æ’­é“¾

```java
DiscoveryClientRouteDefinitionLocator // åŠ è½½æœåŠ¡
    â†“
Reactor Netty HTTP è¯·æ±‚å‘èµ·ï¼ˆå¼‚æ­¥ï¼‰
    â†“
é€šè¿‡ Mono/Flux æ‹¿åˆ°ç›®æ ‡æœåŠ¡åœ°å€
    â†“
GatewayFilterChainï¼ˆå“åº”å¼ Filter æ‰§è¡Œï¼‰
```

---

##  3. Spring Gateway ä¸­çš„æœåŠ¡è°ƒç”¨ â€”â€” å®Œå…¨åŸºäº Reactor

```java
Flux.fromIterable(routeDefinitions)
    .filter(...) // è¿‡æ»¤æœåŠ¡
    .map(...)    // æ˜ å°„æœåŠ¡åœ°å€
    .flatMap(...) // å¼‚æ­¥æ‹‰æœåŠ¡å®ä¾‹
```

å…¶ä¸­ `.flatMap(...)`ã€`.subscribeOn(...)`ã€`.publishOn(...)` çš„æ‰§è¡Œéƒ½åŸºäº `Project Reactor`ã€‚

---

##  4. Nacos è‡ªèº«ä¸å“åº”å¼çš„å¼‚æ­¥/éé˜»å¡è®¾è®¡å¯¹æ¯”

| èƒ½åŠ›         | æ˜¯å¦å“åº”å¼/å¼‚æ­¥ | è¯´æ˜                        |
| ---------- | -------- | ------------------------- |
| æœåŠ¡æ³¨å†Œ       | æ˜¯        | å¼‚æ­¥å‘é€æ³¨å†Œè¯·æ±‚ï¼Œéé˜»å¡å›è°ƒ            |
| æœåŠ¡è®¢é˜…       | æ˜¯        | å»ºç«‹é•¿è¿æ¥ï¼ˆgRPCï¼‰å¼‚æ­¥æ¨é€å˜åŒ–         |
| æœåŠ¡åˆ—è¡¨æ‹‰å–     | æ˜¯        | éé˜»å¡è¯·æ±‚ï¼Œç¼“å­˜æ›´æ–°å¼‚æ­¥æ‰§è¡Œ            |
| SDK å†…éƒ¨çº¿ç¨‹ç®¡ç† | æ˜¯        | å¤šçº¿ç¨‹æ±  + reactor-style è°ƒåº¦æ¨¡å‹ |

---

## â“æ€»ç»“ä¸€å¥è¯å›ç­”ä½ 

> è™½ç„¶ **Nacos æœ¬èº«å¹¶ä¸ç›´æ¥ä¾èµ– Project Reactor**ï¼Œä½†å®ƒåœ¨è®¾è®¡ä¸Šå¤§é‡é‡‡ç”¨äº†å“åº”å¼ç¼–ç¨‹æ€æƒ³ï¼Œç‰¹åˆ«æ˜¯ï¼š
>
> * **äº‹ä»¶é©±åŠ¨**
> * **å¼‚æ­¥éé˜»å¡**
> * **çº¿ç¨‹æ± +å›è°ƒæœºåˆ¶**
>
> å¹¶ä¸”ï¼Œ**å½“ä½ ä½¿ç”¨ Spring Cloud Gateway + Nacos æ—¶ï¼ŒæœåŠ¡å‘ç°è¿‡ç¨‹ä¼š 100% é€šè¿‡ Reactor å¤„ç†æ‰§è¡Œã€‚**

---

å¦‚æœä½ æ­£åœ¨è°ƒè¯• Gateway ä¸­çš„æœåŠ¡å‘ç°è°ƒç”¨é“¾ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ ç”»ä¸€å¼ æµè½¬å›¾æˆ–è€…åˆ—å‡ºè°ƒç”¨æ ˆï¼›å¦‚æœä½ æƒ³æ¨¡æ‹Ÿä¸€ä¸ªæœ€å°çš„è®¢é˜…è°ƒç”¨é“¾è°ƒè¯•æ ·ä¾‹ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ æ­å»ºï¼Œæ˜¯å¦éœ€è¦ï¼Ÿ
