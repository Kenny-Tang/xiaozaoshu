Python é­”æœ¯æ–¹æ³•

Python ä¸­çš„é­”æœ¯æ–¹æ³•ï¼ˆMagic Methodsï¼‰ï¼Œåˆå«â€œ**åŒä¸‹æ–¹æ³•ï¼ˆdunder methodsï¼‰**â€ï¼Œåƒ `__init__`ã€`__str__`ã€`__eq__` è¿™æ ·çš„åå­—ï¼Œæ˜¯ Python é¢å‘å¯¹è±¡éå¸¸å¼ºå¤§çš„ç‰¹æ€§ã€‚

---

## å¸¸ç”¨é­”æœ¯æ–¹æ³•è¯¦è§£

æœ€å¸¸è§ä¹Ÿæœ€æœ‰ç”¨çš„å‡ ä¸ªé­”æœ¯æ–¹æ³•ï¼š

---

### 1. `__init__(self, ...)` â€”â€” æ„é€ æ–¹æ³•

**ä½œç”¨**ï¼šåˆå§‹åŒ–å¯¹è±¡å±æ€§
**ä½•æ—¶è§¦å‘**ï¼š`ç±»å(...)` åˆ›å»ºå®ä¾‹æ—¶è‡ªåŠ¨è°ƒç”¨

åŒ `Java` ä¸­çš„æ„é€ å‡½æ•°ç±»ä¼¼ï¼Œ`__init__` æ–¹æ³•åœ¨åˆ›å»ºå¯¹è±¡æ—¶è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œç”¨æ¥è®¾ç½®åˆå§‹çŠ¶æ€ã€‚

```python
class Person:
    def __init__(self, name):
        self.name = name

p = Person("Alice")  # è‡ªåŠ¨è°ƒç”¨ __init__
```

---

### 2. `__str__(self)` â€”â€” å­—ç¬¦ä¸²è¡¨ç¤ºï¼ˆç»™ç”¨æˆ·çœ‹çš„ï¼‰

**ä½œç”¨**ï¼šå®šä¹‰ `print(obj)` æˆ– `str(obj)` æ—¶çš„è¿”å›å€¼ï¼ˆé€‚åˆâ€œäººç±»å¯è¯»â€æ ¼å¼ï¼‰
**ä½•æ—¶è§¦å‘**ï¼š`print(obj)` æˆ– `str(obj)`

åŒ `Java` ä¸­çš„ `toString()` æ–¹æ³•ï¼Œ`__str__` ç”¨äºå®šä¹‰å¯¹è±¡çš„â€œå‹å¥½â€å­—ç¬¦ä¸²è¡¨ç¤ºã€‚

```python
class Person:
    def __init__(self, name):
        self.name = name

    def __str__(self):
        return f"ğŸ‘¤ å§“åï¼š{self.name}"

p = Person("Bob")
print(p)  # è¾“å‡ºï¼šğŸ‘¤ å§“åï¼šBob
```

---

### 3. `__repr__(self)` â€”â€” å®˜æ–¹è¡¨ç¤ºï¼ˆç»™å¼€å‘è€…çœ‹çš„ï¼‰

**ä½œç”¨**ï¼šç”¨äºè°ƒè¯•æˆ–äº¤äº’ç¯å¢ƒä¸­æ˜¾ç¤ºå¯¹è±¡ä¿¡æ¯ï¼ˆâ€œæœºå™¨å¯è¯»â€æ ¼å¼ï¼‰
**ä½•æ—¶è§¦å‘**ï¼šç›´æ¥è¾“å…¥å¯¹è±¡åã€è°ƒç”¨ `repr(obj)`ï¼Œæˆ–æ²¡æœ‰å®šä¹‰ `__str__` æ—¶ `print(obj)` ä¹Ÿä¼šé€€å›ç”¨ `__repr__`

ç»™å¼€å‘è€…çœ‹çš„ï¼Œå®ƒé€šå¸¸è¿”å›ä¸€ä¸ªå¯ä»¥ç”¨æ¥é‡æ–°åˆ›å»ºè¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²å¥½å§ï¼Œæˆ‘å¹¶ä¸èƒ½ç†è§£è¿™ä¸ªæ–¹æ³•çš„å®é™…æ„ä¹‰ã€‚

```python
class Person:
    def __init__(self, name):
        self.name = name

    def __repr__(self):
        return f"Person(name='{self.name}')"

p = Person("Bob")
p  # è¾“å‡ºï¼šPerson(name='Bob')ï¼ˆåœ¨ REPL/è°ƒè¯•å™¨ä¸­ï¼‰
```

---

### 4. `__eq__(self, other)` â€”â€” åˆ¤æ–­ç›¸ç­‰ï¼ˆ==ï¼‰

**ä½œç”¨**ï¼šè‡ªå®šä¹‰ä¸¤ä¸ªå¯¹è±¡ `==` çš„æ¯”è¾ƒæ–¹å¼
**ä½•æ—¶è§¦å‘**ï¼šä½¿ç”¨ `obj1 == obj2` æ—¶

åŒ `Java` ä¸­çš„ `equals()` æ–¹æ³•ï¼Œ`__eq__` ç”¨äºå®šä¹‰å¯¹è±¡ä¹‹é—´çš„ç›¸ç­‰æ¯”è¾ƒ, ä¸è¿‡ `Java` ä¸­é‡å†™ `equals()` è¿˜éœ€è¦é‡å†™ `hashCode()` æ–¹æ³•ï¼Œè€Œ `Python` ä¸­æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚

```python
class Person:
    def __init__(self, name):
        self.name = name

    def __eq__(self, other):
        return isinstance(other, Person) and self.name == other.name

p1 = Person("Alice")
p2 = Person("Alice")
print(p1 == p2)  # True
```

> é»˜è®¤æƒ…å†µä¸‹ `==` æ˜¯æ¯”è¾ƒåœ°å€ï¼ˆæ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚å¦‚æœä½ è¦æŒ‰å€¼æ¯”è¾ƒï¼Œéœ€è¦é‡å†™ `__eq__`ã€‚

---

### 5. `__len__(self)` â€”â€” æ”¯æŒ `len(obj)`

**ä½œç”¨**ï¼šè®©ä½ çš„ç±»å¯¹è±¡å¯ä»¥ç”¨ `len()` å‡½æ•°
**ä½•æ—¶è§¦å‘**ï¼šè°ƒç”¨ `len(obj)` æ—¶

`Java` ä¸­çš„ `size()` æ–¹æ³•ç±»ä¼¼ï¼Œä¸è¿‡ `Java` ä¸­ä»…é›†åˆå¯¹è±¡å’Œæ•°ç»„æœ‰ç±»ä¼¼å±æ€§ï¼Œæ™®é€šå¯¹è±¡æ²¡æœ‰ï¼Œï¼Œä½†æ˜¯æ„Ÿè§‰å³ä½¿åœ¨ `Python` ä¸­ä¹Ÿä¸»è¦æ˜¯ç”¨äºé›†åˆå¯¹è±¡çš„æ“ä½œï¼Œè¿™ç§æ–¹æ³•å®šä¹‰å’Œä½¿ç”¨å’Œ `Javascript` çš„è¯­æ³•æ›´æ¥è¿‘ï¼Œå¯èƒ½è¿™æ˜¯æ˜¯è„šæœ¬è¯­è¨€å…±æœ‰çš„ä¹ æƒ¯ã€‚

```python
class Group:
    def __init__(self, members):
        self.members = members

    def __len__(self):
        return len(self.members)

g = Group(["Alice", "Bob"])
print(len(g))  # è¾“å‡º 2
```

---

### 6. `__getitem__`, `__setitem__` â€”â€” ä¸‹æ ‡æ“ä½œæ”¯æŒ

è®©ä½ çš„å¯¹è±¡å¯ä»¥åƒåˆ—è¡¨ä¸€æ ·ç”¨ `obj[i]` è®¿é—®ï¼š

```python
class MyList:
    def __init__(self):
        self.data = [1, 2, 3]

    def __getitem__(self, index):
        return self.data[index]

    def __setitem__(self, index, value):
        self.data[index] = value

ml = MyList()
print(ml[1])   # è¾“å‡º 2
ml[1] = 100
print(ml[1])   # è¾“å‡º 100
```

---

## æ€»ç»“è¡¨ï¼šå¸¸è§é­”æœ¯æ–¹æ³•

| é­”æœ¯æ–¹æ³•           | åŠŸèƒ½æè¿°         | ç¤ºä¾‹è§¦å‘æ–¹å¼             |
| -------------- | ------------ | ------------------ |
| `__init__`     | æ„é€ æ–¹æ³•         | `obj = Class(...)` |
| `__str__`      | ç”¨æˆ·å¯è¯»çš„å­—ç¬¦ä¸²è¡¨ç¤º   | `print(obj)`       |
| `__repr__`     | å¼€å‘è€…è°ƒè¯•ç”¨çš„å­—ç¬¦ä¸²è¡¨ç¤º | `repr(obj)` / ç›´æ¥è¾“å…¥ |
| `__eq__`       | ç­‰å€¼åˆ¤æ–­ï¼ˆ==ï¼‰     | `obj1 == obj2`     |
| `__len__`      | é•¿åº¦æ”¯æŒ         | `len(obj)`         |
| `__getitem__`  | ä¸‹æ ‡è¯»å–         | `obj[i]`           |
| `__setitem__`  | ä¸‹æ ‡å†™å…¥         | `obj[i] = x`       |
| `__delitem__`  | ä¸‹æ ‡åˆ é™¤         | `del obj[i]`       |
| `__contains__` | æˆå‘˜åˆ¤æ–­         | `x in obj`         |

---



## ğŸ§™â€â™‚ï¸ è¿›é˜¶é­”æœ¯æ–¹æ³•è¯¦è§£ï¼ˆé«˜çº§ç¯‡ï¼‰

### 1. `__call__(self, ...)` â€”â€” è®©å¯¹è±¡â€œåƒå‡½æ•°ä¸€æ ·â€è¢«è°ƒç”¨

**ä½œç”¨**ï¼šè®©å¯¹è±¡å®ä¾‹åƒå‡½æ•°ä¸€æ ·å¯ä»¥è¢«â€œè°ƒç”¨â€ã€‚

 **è§¦å‘æ–¹å¼**ï¼š`obj(...)`

```python
class Greeter:
    def __init__(self, name):
        self.name = name

    def __call__(self):
        print(f"Hello, Iâ€™m {self.name}")

g = Greeter("Alice")
g()  # è¾“å‡ºï¼šHello, Iâ€™m Alice
```

ğŸ” å¸¸ç”¨äºï¼š

* å°è£…å‡½æ•°é€»è¾‘
* å®ç°â€œå¯è°ƒç”¨å¯¹è±¡â€/â€œè¡Œä¸ºå‚æ•°â€

---

### 2. `__iter__(self)` + `__next__(self)` â€”â€” è®©å¯¹è±¡å¯ä»¥è¢« `for` éå†

**ä½œç”¨**ï¼šè®©ä½ çš„ç±»æ”¯æŒè¿­ä»£ï¼ˆ`for x in obj:`ï¼‰

**è§¦å‘æ–¹å¼**ï¼š`for` å¾ªç¯ã€åˆ—è¡¨æ¨å¯¼ã€`list(obj)`

åœ¨è¿™ä¸€æ–¹é¢ï¼Œ`Python' æ¯” `Java' æ›´åŠ çµæ´»å’Œç®€æ´ï¼Œæ›´è´´è¿‘é¢å‘å¯¹è±¡çš„æ¦‚å¿µã€‚

```python
class Counter:
    def __init__(self, limit):
        self.limit = limit
        self.current = 0

    def __iter__(self):
        return self  # è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ selfï¼‰

    def __next__(self):
        if self.current < self.limit:
            self.current += 1
            return self.current
        raise StopIteration  # è¿­ä»£ç»“æŸ

for num in Counter(3):
    print(num)  # è¾“å‡º 1, 2, 3
```

æ›´å¸¸è§ç”¨æ³•æ˜¯è®© `__iter__` è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨æˆ–è¿­ä»£å™¨å¯¹è±¡ã€‚

---

### 3. `__enter__` + `__exit__` â€”â€” ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆæ”¯æŒ `with` è¯­å¥ï¼‰

**ä½œç”¨**ï¼šæ”¯æŒ `with` è¯­æ³•ï¼Œå¸¸ç”¨äºèµ„æºç®¡ç†ï¼ˆå¦‚æ–‡ä»¶ã€æ•°æ®åº“ã€é”ç­‰ï¼‰

 **è§¦å‘æ–¹å¼**ï¼š`with obj as x: ...`

```python
class FileMock:
    def __enter__(self):
        print("ğŸ”“ æ‰“å¼€èµ„æº")
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        print("ğŸ”’ å…³é—­èµ„æº")

with FileMock() as f:
    print("å¤„ç†ä¸­...")
```

ğŸ“ è¾“å‡ºï¼š

```
ğŸ”“ æ‰“å¼€èµ„æº
å¤„ç†ä¸­...
ğŸ”’ å…³é—­èµ„æº
```

---

### 4. `__contains__(self, item)` â€”â€” æ”¯æŒ `in` æ“ä½œ

**ä½œç”¨**ï¼šè®© `x in obj` æˆç«‹

```python
class Bag:
    def __init__(self, items):
        self.items = items

    def __contains__(self, item):
        return item in self.items

bag = Bag(["apple", "banana"])
print("apple" in bag)   # True
print("orange" in bag)  # False
```

---

## æ€»ç»“ï¼šè¿›é˜¶é­”æœ¯æ–¹æ³•èƒ½åŠ›è¡¨

| é­”æœ¯æ–¹æ³•           | ç”¨é€”            | ç¤ºä¾‹                  |
| -------------- | ------------- | ------------------- |
| `__call__`     | è®©å¯¹è±¡åƒå‡½æ•°ä¸€æ ·è°ƒç”¨    | `obj()`             |
| `__iter__`     | è¿”å›è¿­ä»£å™¨         | `for x in obj:`     |
| `__next__`     | è·å–ä¸‹ä¸€ä¸ªå€¼        | é€šå¸¸ä¸ `__iter__` é…å¥—ä½¿ç”¨ |
| `__enter__`    | è¿›å…¥ `with` è¯­å¥å— | `with obj as x:`    |
| `__exit__`     | ç¦»å¼€ `with` è¯­å¥å— | è‡ªåŠ¨é‡Šæ”¾èµ„æº              |
| `__contains__` | æ”¯æŒ `in` æ“ä½œ    | `x in obj`          |

---

### å®ç”¨å»ºè®®ï¼š

* å¦‚æœä½ å†™çš„æ˜¯**å·¥å…·ç±» / æ•°æ®æ¨¡å‹ç±» / æ¡†æ¶ä¸­çš„ç»„ä»¶ç±»**ï¼Œè¿™äº›é­”æœ¯æ–¹æ³•å¯ä»¥è®©ä½ çš„ä»£ç æ›´ä¼˜é›…ã€ç®€æ´ã€Pythonicã€‚
* ç†Ÿç»ƒæŒæ¡è¿™äº›æ–¹æ³•ï¼Œä¹Ÿèƒ½æ›´å®¹æ˜“çœ‹æ‡‚ Flaskã€Djangoã€Pandasã€FastAPI ç­‰æ¡†æ¶çš„åº•å±‚è®¾è®¡ã€‚

